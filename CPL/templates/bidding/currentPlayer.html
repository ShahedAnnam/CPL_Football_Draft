<!DOCTYPE html>
<html>
  <head>
    <title>Current Player</title>
  </head>
  <body>
    <p><strong>Server Time:</strong> {{ server_time|date:"Y-m-d H:i:s" }}</p>

    {% if info.status == 'not_started' %}
    <h2>Auction has not started yet.</h2>
    <p>
      <strong>Time until start:</strong> {{ info.time_until_start }} seconds
    </p>

    {% elif info.status == 'finished' %}
    <h2>Auction is finished.</h2>
    <p>
      <strong>Time since auction ended:</strong> {{ info.time_since_end }}
      seconds ago
    </p>

    {% elif info.status == 'active' %}
    <div>
      <h2>{{ info.player.name }}</h2>

      {% if info.player.profile_picture_url %}
      <img
        src="{{ info.player.profile_picture_url }}"
        width="150"
        alt="Profile Picture"
      />
      {% endif %}

      <p><strong>Age:</strong> {{ info.player.age }}</p>
      <p><strong>Position:</strong> {{ info.player.playing_position }}</p>
      <p><strong>Batch:</strong> {{ info.player.batch }}</p>
      <p><strong>Contact:</strong> {{ info.player.contact_number }}</p>
      <p id="assigned-team-{{ info.player.id }}" class="card-text">
        Last Bid: {{ info.player.assigned_team }}
      </p>
      <p id="price-{{ info.player.id }}" class="card-text">
        Last Bid Price: {{ info.player.price }}
      </p>
      
      <p>
        <strong>Seconds Remaining for This Player:</strong> 
        {{info.seconds_remaining}}
      </p>
      <p>
        <strong>Total Time Left in Auction:</strong> {{ info.total_time_left }}
        seconds
      </p>
      {% if user.is_authenticated and user.role == 'team' %}
      <button class="btn btn-primary" onclick="placeBid({{ info.player.id }})">
        Place bid
      </button>
      {% endif %}
    </div>
    {% endif %}

    <script>
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2)
          return decodeURIComponent(parts.pop().split(";").shift());
      }
      function placeBid(playerId) {
        fetch("place-bid/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"),
          },
          body: JSON.stringify({ player_id: playerId }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              const teamEl = document.getElementById(
                `assigned-team-${playerId}`
              );
              const priceEl = document.getElementById(`price-${playerId}`);
              if (teamEl)
                teamEl.textContent = `Last Bid: ${data.assigned_team}`;
              if (priceEl)
                priceEl.textContent = `Last Bid Price: ${data.price}`;
            } else {
              alert(data.message || "Bid failed");
            }
          })
          .catch((error) => {
            console.error("Error placing bid:", error);
          });
      }
    </script>
  </body>
</html>
